# í”„ë¡œí•„ ì‹œìŠ¤í…œ ì„¤ê³„

> ì‘ì„±ì¼: 2026-01-29
> ìƒíƒœ: ìŠ¹ì¸ë¨

## ê°œìš”

RunningMate ì•±ì˜ í”„ë¡œí•„ ì‹œìŠ¤í…œ ì„¤ê³„ ë¬¸ì„œì…ë‹ˆë‹¤. ëŸ¬ë„ˆì˜ ì„±ì¥ ê¸°ë¡ê³¼ ì •ì²´ì„±ì„ ë³´ì—¬ì£¼ëŠ” í—ˆë¸Œ ì—­í• ì„ í•©ë‹ˆë‹¤.

### í•µì‹¬ ê¸°ëŠ¥

- ëŸ¬ë‹ í†µê³„ (ëˆ„ì /ì›”ê°„/ì£¼ê°„)
- ë ˆë²¨ & XP ì‹œìŠ¤í…œ
- ì—…ì  ì‡¼ì¼€ì´ìŠ¤
- ëª©í‘œ ì§„í–‰ë¥ 
- ì•± ì„¤ì •

---

## 1. í™”ë©´ êµ¬ì„±

### ë©”ì¸ í”„ë¡œí•„ í™”ë©´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [í”„ë¡œí•„ í—¤ë”]                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  ë‹‰ë„¤ì„                  â”‚
â”‚  â”‚ ì•„ë°”íƒ€ â”‚  Lv.12 ëŸ¬ë‹ë©”ì´íŠ¸       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 2,400/3,000 XPâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ì´ë²ˆ ë‹¬ ìš”ì•½]                     â”‚
â”‚  ğŸƒ 12íšŒ  ğŸ“ 58.3km  â±ï¸ 5h 23m     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ëˆ„ì  ê¸°ë¡]                        â”‚
â”‚  ì´ ê±°ë¦¬    ì´ ì‹œê°„    ì´ ëŸ¬ë‹      â”‚
â”‚  423.5km   38h 15m    89íšŒ          â”‚
â”‚  í‰ê·  í˜ì´ìŠ¤   ì´ ì¹¼ë¡œë¦¬            â”‚
â”‚  5'42"/km     28,450kcal            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ì—…ì  ì‡¼ì¼€ì´ìŠ¤]                    â”‚
â”‚  ğŸ† ğŸ† ğŸ† +12ê°œ ë” ë³´ê¸° >           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ëª©í‘œ ì§„í–‰ë¥ ]                      â”‚
â”‚  ë§ˆë¼í†¤ ì™„ì£¼ ëª©í‘œ                   â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 78%              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ë©”ë‰´]                             â”‚
â”‚  > ëŸ¬ë‹ ê¸°ë¡                        â”‚
â”‚  > ì—…ì                              â”‚
â”‚  > ë„ì „ ê³¼ì œ                        â”‚
â”‚  > ì„¤ì •                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•˜ìœ„ í™”ë©´

| í™”ë©´ | ì„¤ëª… |
|------|------|
| ëŸ¬ë‹ ê¸°ë¡ | ëŸ¬ë‹ ì„¸ì…˜ íˆìŠ¤í† ë¦¬, ìº˜ë¦°ë” ë·° |
| ì—…ì  | ì „ì²´ ì—…ì  ëª©ë¡, ì§„í–‰ë¥  |
| ë„ì „ ê³¼ì œ | í™œì„±/ì™„ë£Œëœ ë„ì „ ëª©ë¡ |
| ì„¤ì • | ì•± ì„¤ì •, ê³„ì • ê´€ë¦¬ |

---

## 2. ë°ì´í„° ëª¨ë¸

### ProfileStats

```dart
class ProfileStats {
  // ì „ì²´ ëˆ„ì 
  double totalDistanceKm;
  Duration totalDuration;
  int totalRunCount;
  int totalCalories;

  // í‰ê· ê°’
  double avgPaceMinPerKm;
  double avgDistancePerRun;

  // ì´ë²ˆ ë‹¬
  double monthlyDistanceKm;
  Duration monthlyDuration;
  int monthlyRunCount;

  // ì´ë²ˆ ì£¼
  double weeklyDistanceKm;
  int weeklyRunCount;

  // ìµœê³  ê¸°ë¡
  double longestRunKm;
  Duration longestDuration;
  double fastestPaceMinPerKm;

  // ì—°ì† ê¸°ë¡
  int currentStreak;        // í˜„ì¬ ì—°ì† ëŸ¬ë‹ ì¼ìˆ˜
  int longestStreak;        // ìµœì¥ ì—°ì† ëŸ¬ë‹ ì¼ìˆ˜
}
```

### UserLevel

```dart
class UserLevel {
  int level;
  int currentXp;
  int xpForNextLevel;
  String title;              // "ëŸ¬ë‹ ì´ˆë³´ì", "ëŸ¬ë‹ë©”ì´íŠ¸" ë“±

  double get progressPercent => currentXp / xpForNextLevel;
}
```

### Achievement

```dart
class Achievement {
  String id;
  String name;
  String description;
  String iconUrl;
  int xpReward;
  AchievementCategory category;

  // ì§„í–‰ë¥  (ë¯¸íšë“ ì—…ì ìš©)
  int? currentProgress;
  int? targetProgress;

  // íšë“ ì •ë³´
  bool isUnlocked;
  DateTime? unlockedAt;
}

enum AchievementCategory {
  distance,
  streak,
  record,
  exploration,
  social,
}
```

### UserSettings

```dart
class UserSettings {
  // ëŸ¬ë‹
  bool autoPause;
  GpsPrecision gpsPrecision;
  bool voiceCoaching;
  String coachingLanguage;

  // ë‹¨ìœ„
  DistanceUnit distanceUnit;
  WeightUnit weightUnit;

  // ì•Œë¦¼
  bool runningReminder;
  TimeOfDay? reminderTime;
  bool achievementNotification;
  bool challengeNotification;
}

enum GpsPrecision { high, normal, batterySaver }
enum DistanceUnit { km, mi }
enum WeightUnit { kg, lb }
```

---

## 3. Supabase í…Œì´ë¸”

### user_xp_logs (XP ê¸°ë¡)

```sql
create table user_xp_logs (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references auth.users(id) on delete cascade,
  xp_amount int not null,
  source text not null,           -- 'run_complete', 'achievement', 'challenge'
  source_id uuid,                 -- run_session_id, achievement_id ë“±
  created_at timestamptz default now()
);

-- ì¸ë±ìŠ¤
create index idx_user_xp_logs_user on user_xp_logs(user_id);
```

### user_achievements (íšë“í•œ ì—…ì )

```sql
create table user_achievements (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references auth.users(id) on delete cascade,
  achievement_id text not null,   -- ì—…ì  ì‹ë³„ì
  unlocked_at timestamptz default now(),

  unique(user_id, achievement_id)
);

-- ì¸ë±ìŠ¤
create index idx_user_achievements_user on user_achievements(user_id);
```

### user_settings (ì‚¬ìš©ì ì„¤ì •)

```sql
create table user_settings (
  user_id uuid primary key references auth.users(id) on delete cascade,

  -- ëŸ¬ë‹ ì„¤ì •
  auto_pause boolean default true,
  gps_precision text default 'normal',
  voice_coaching boolean default true,
  coaching_language text default 'ko',

  -- ë‹¨ìœ„ ì„¤ì •
  distance_unit text default 'km',
  weight_unit text default 'kg',

  -- ì•Œë¦¼ ì„¤ì •
  running_reminder boolean default false,
  reminder_time time,
  achievement_notification boolean default true,
  challenge_notification boolean default true,

  updated_at timestamptz default now()
);

-- RLS ì •ì±…
alter table user_settings enable row level security;

create policy "Users can manage own settings"
  on user_settings for all
  using (auth.uid() = user_id);
```

### í†µê³„ ì§‘ê³„ ë·°

```sql
-- ì‚¬ìš©ìë³„ í†µê³„ ì§‘ê³„ ë·°
create view user_stats_summary as
select
  user_id,
  -- ì „ì²´ ëˆ„ì 
  count(*) as total_run_count,
  coalesce(sum(distance_meters) / 1000.0, 0) as total_distance_km,
  coalesce(sum(duration_seconds), 0) as total_duration_seconds,
  coalesce(sum(calories_burned), 0) as total_calories,

  -- í‰ê· 
  coalesce(avg(distance_meters / nullif(duration_seconds, 0) * 1000 / 60), 0) as avg_pace_min_per_km,
  coalesce(avg(distance_meters) / 1000.0, 0) as avg_distance_km,

  -- ìµœê³  ê¸°ë¡
  coalesce(max(distance_meters) / 1000.0, 0) as longest_run_km,
  coalesce(max(duration_seconds), 0) as longest_duration_seconds,
  coalesce(min(distance_meters / nullif(duration_seconds, 0) * 1000 / 60), 0) as fastest_pace_min_per_km,

  -- ì´ë²ˆ ë‹¬
  coalesce(sum(case when date_trunc('month', started_at) = date_trunc('month', now())
      then distance_meters else 0 end) / 1000.0, 0) as monthly_distance_km,
  coalesce(sum(case when date_trunc('month', started_at) = date_trunc('month', now())
      then duration_seconds else 0 end), 0) as monthly_duration_seconds,
  count(case when date_trunc('month', started_at) = date_trunc('month', now())
      then 1 end) as monthly_run_count,

  -- ì´ë²ˆ ì£¼
  coalesce(sum(case when date_trunc('week', started_at) = date_trunc('week', now())
      then distance_meters else 0 end) / 1000.0, 0) as weekly_distance_km,
  count(case when date_trunc('week', started_at) = date_trunc('week', now())
      then 1 end) as weekly_run_count

from run_sessions
where status = 'completed'
group by user_id;

-- ì‚¬ìš©ìë³„ ì´ XP
create view user_total_xp as
select
  user_id,
  coalesce(sum(xp_amount), 0) as total_xp
from user_xp_logs
group by user_id;
```

---

## 4. ë ˆë²¨ & ì¹­í˜¸ ì‹œìŠ¤í…œ

### ë ˆë²¨ í…Œì´ë¸”

| ë ˆë²¨ | í•„ìš” XP | ëˆ„ì  XP | ì¹­í˜¸ |
|------|---------|---------|------|
| 1 | 0 | 0 | ëŸ¬ë‹ ì…ë¬¸ì |
| 2 | 100 | 100 | ëŸ¬ë‹ ì´ˆë³´ì |
| 3 | 200 | 300 | ê¾¸ì¤€í•œ ëŸ¬ë„ˆ |
| 4 | 300 | 600 | ì„±ì‹¤í•œ ëŸ¬ë„ˆ |
| 5 | 400 | 1,000 | ëŸ¬ë‹ë©”ì´íŠ¸ |
| 7 | 500 | 2,000 | ì—´ì • ëŸ¬ë„ˆ |
| 10 | 700 | 4,100 | ìˆ™ë ¨ ëŸ¬ë„ˆ |
| 15 | 1,000 | 9,100 | ë² í…Œë‘ ëŸ¬ë„ˆ |
| 20 | 1,400 | 16,100 | ë§ˆë¼í† ë„ˆ |
| 25 | 1,800 | 25,100 | ì—˜ë¦¬íŠ¸ ëŸ¬ë„ˆ |
| 30 | 2,300 | 36,600 | ë§ˆìŠ¤í„° ëŸ¬ë„ˆ |

### XP íšë“ ì¡°ê±´

| í™œë™ | XP |
|------|-----|
| ëŸ¬ë‹ ì™„ë£Œ (1kmë‹¹) | +10 XP |
| ëª©í‘œ í˜ì´ìŠ¤ ë‹¬ì„± | +20 XP |
| ìƒˆ ì½”ìŠ¤ ì™„ì£¼ | +30 XP |
| ì£¼ê°„ ëª©í‘œ ë‹¬ì„± | +50 XP |
| ì—…ì  ë‹¬ì„± (ë“±ê¸‰ë³„) | +50~300 XP |
| ë„ì „ ì™„ë£Œ | +100 XP |
| ì—°ì† ëŸ¬ë‹ ë³´ë„ˆìŠ¤ (7ì¼) | +70 XP |
| ì—°ì† ëŸ¬ë‹ ë³´ë„ˆìŠ¤ (30ì¼) | +200 XP |

### ë ˆë²¨ ê³„ì‚° ë¡œì§

```dart
class LevelService {
  static const levelTable = [
    (level: 1, cumulativeXp: 0, title: 'ëŸ¬ë‹ ì…ë¬¸ì'),
    (level: 2, cumulativeXp: 100, title: 'ëŸ¬ë‹ ì´ˆë³´ì'),
    (level: 3, cumulativeXp: 300, title: 'ê¾¸ì¤€í•œ ëŸ¬ë„ˆ'),
    (level: 4, cumulativeXp: 600, title: 'ì„±ì‹¤í•œ ëŸ¬ë„ˆ'),
    (level: 5, cumulativeXp: 1000, title: 'ëŸ¬ë‹ë©”ì´íŠ¸'),
    (level: 7, cumulativeXp: 2000, title: 'ì—´ì • ëŸ¬ë„ˆ'),
    (level: 10, cumulativeXp: 4100, title: 'ìˆ™ë ¨ ëŸ¬ë„ˆ'),
    (level: 15, cumulativeXp: 9100, title: 'ë² í…Œë‘ ëŸ¬ë„ˆ'),
    (level: 20, cumulativeXp: 16100, title: 'ë§ˆë¼í† ë„ˆ'),
    (level: 25, cumulativeXp: 25100, title: 'ì—˜ë¦¬íŠ¸ ëŸ¬ë„ˆ'),
    (level: 30, cumulativeXp: 36600, title: 'ë§ˆìŠ¤í„° ëŸ¬ë„ˆ'),
  ];

  UserLevel calculateLevel(int totalXp) {
    var current = levelTable.first;
    var next = levelTable.length > 1 ? levelTable[1] : current;

    for (var i = 0; i < levelTable.length; i++) {
      if (totalXp >= levelTable[i].cumulativeXp) {
        current = levelTable[i];
        next = i < levelTable.length - 1 ? levelTable[i + 1] : current;
      }
    }

    final xpInCurrentLevel = totalXp - current.cumulativeXp;
    final xpNeededForNext = next.cumulativeXp - current.cumulativeXp;

    return UserLevel(
      level: current.level,
      currentXp: xpInCurrentLevel,
      xpForNextLevel: xpNeededForNext,
      title: current.title,
    );
  }
}
```

---

## 5. ì—…ì  ì‹œìŠ¤í…œ

### ì—…ì  ì¹´í…Œê³ ë¦¬ ë° ëª©ë¡

**ê±°ë¦¬ ì—…ì  (Distance)**

| ID | ì—…ì  | ì¡°ê±´ | XP |
|----|------|------|-----|
| dist_first | ğŸ¥‰ ì²« ë°œìêµ­ | ì²« ëŸ¬ë‹ ì™„ë£Œ | +50 |
| dist_10 | ğŸ¥ˆ 10km ë‹¬ì„± | ëˆ„ì  10km | +50 |
| dist_50 | ğŸ¥ˆ 50km ëŒíŒŒ | ëˆ„ì  50km | +75 |
| dist_100 | ğŸ¥‡ 100km í´ëŸ½ | ëˆ„ì  100km | +100 |
| dist_500 | ğŸ† 500km ëŸ¬ë„ˆ | ëˆ„ì  500km | +200 |
| dist_1000 | ğŸ† 1000km ì „ì„¤ | ëˆ„ì  1000km | +300 |

**ì—°ì† ì—…ì  (Streak)**

| ID | ì—…ì  | ì¡°ê±´ | XP |
|----|------|------|-----|
| streak_3 | ğŸ”¥ 3ì¼ ì—°ì† | 3ì¼ ì—°ì† ëŸ¬ë‹ | +30 |
| streak_7 | ğŸ”¥ğŸ”¥ 7ì¼ ì—°ì† | 7ì¼ ì—°ì† ëŸ¬ë‹ | +70 |
| streak_14 | ğŸ”¥ğŸ”¥ 2ì£¼ ì—°ì† | 14ì¼ ì—°ì† ëŸ¬ë‹ | +100 |
| streak_30 | ğŸ”¥ğŸ”¥ğŸ”¥ 30ì¼ ì—°ì† | 30ì¼ ì—°ì† ëŸ¬ë‹ | +200 |
| streak_100 | ğŸ’ 100ì¼ ì—°ì† | 100ì¼ ì—°ì† ëŸ¬ë‹ | +500 |

**ê¸°ë¡ ì—…ì  (Record)**

| ID | ì—…ì  | ì¡°ê±´ | XP |
|----|------|------|-----|
| pace_6 | âš¡ 6ë¶„ í˜ì´ìŠ¤ | 6ë¶„/km ì´í•˜ ë‹¬ì„± | +50 |
| pace_5 | âš¡âš¡ 5ë¶„ í˜ì´ìŠ¤ | 5ë¶„/km ì´í•˜ ë‹¬ì„± | +100 |
| pace_4 | âš¡âš¡âš¡ 4ë¶„ í˜ì´ìŠ¤ | 4ë¶„/km ì´í•˜ ë‹¬ì„± | +200 |
| run_10k | ğŸƒ 10K ì™„ì£¼ | í•œ ë²ˆì— 10km ì™„ì£¼ | +100 |
| run_half | ğŸƒ í•˜í”„ ë§ˆë¼í†¤ | í•œ ë²ˆì— 21km ì™„ì£¼ | +150 |
| run_full | ğŸƒâ€â™‚ï¸ í’€ ë§ˆë¼í†¤ | í•œ ë²ˆì— 42km ì™„ì£¼ | +300 |

**íƒí—˜ ì—…ì  (Exploration)**

| ID | ì—…ì  | ì¡°ê±´ | XP |
|----|------|------|-----|
| course_5 | ğŸ—ºï¸ íƒí—˜ ì‹œì‘ | 5ê°œ ì½”ìŠ¤ ì™„ì£¼ | +50 |
| course_10 | ğŸ—ºï¸ğŸ—ºï¸ íƒí—˜ê°€ | 10ê°œ ì½”ìŠ¤ ì™„ì£¼ | +100 |
| course_50 | ğŸŒ ì½”ìŠ¤ ë§ˆìŠ¤í„° | 50ê°œ ì½”ìŠ¤ ì™„ì£¼ | +200 |

**ì†Œì…œ ì—…ì  (Social)**

| ID | ì—…ì  | ì¡°ê±´ | XP |
|----|------|------|-----|
| share_first | ğŸ“¤ ì²« ê³µìœ  | ì½”ìŠ¤ ì²« ê³µìœ  | +30 |
| review_10 | â­ ë¦¬ë·°ì–´ | 10ê°œ ì½”ìŠ¤ ë¦¬ë·° ì‘ì„± | +50 |
| challenge_join | ğŸ¤ ë„ì „ì | ì²« ë„ì „ ì°¸ì—¬ | +30 |
| challenge_win | ğŸ† ì±”í”¼ì–¸ | ë„ì „ 1ìœ„ ë‹¬ì„± | +100 |

### ì—…ì  ì²´í¬ ë¡œì§

```dart
class AchievementService {
  Future<List<Achievement>> checkNewAchievements(String userId) async {
    final stats = await getProfileStats(userId);
    final existing = await getUnlockedAchievements(userId);
    final newAchievements = <Achievement>[];

    // ê±°ë¦¬ ì—…ì  ì²´í¬
    if (!existing.contains('dist_10') && stats.totalDistanceKm >= 10) {
      newAchievements.add(achievements['dist_10']!);
    }
    // ... ê¸°íƒ€ ì—…ì  ì²´í¬

    // ìƒˆ ì—…ì  ì €ì¥ ë° XP ë¶€ì—¬
    for (final achievement in newAchievements) {
      await unlockAchievement(userId, achievement);
      await addXp(userId, achievement.xpReward, 'achievement', achievement.id);
    }

    return newAchievements;
  }
}
```

---

## 6. ì„¤ì • í™”ë©´ êµ¬ì¡°

### ë©”ë‰´ êµ¬ì„±

```
[ì„¤ì •]
â”œâ”€â”€ ëŸ¬ë‹ ì„¤ì •
â”‚   â”œâ”€â”€ ìë™ ì¼ì‹œì •ì§€ (on/off)
â”‚   â”œâ”€â”€ GPS ì •ë°€ë„ (ë†’ìŒ/ë³´í†µ/ì ˆì „)
â”‚   â”œâ”€â”€ ìŒì„± ì½”ì¹­ (on/off)
â”‚   â””â”€â”€ ì½”ì¹­ ì–¸ì–´ (í•œêµ­ì–´/English)
â”‚
â”œâ”€â”€ ë‹¨ìœ„ ì„¤ì •
â”‚   â”œâ”€â”€ ê±°ë¦¬ (km/mi)
â”‚   â””â”€â”€ ì²´ì¤‘ (kg/lb)
â”‚
â”œâ”€â”€ ì•Œë¦¼ ì„¤ì •
â”‚   â”œâ”€â”€ ëŸ¬ë‹ ë¦¬ë§ˆì¸ë” (on/off)
â”‚   â”œâ”€â”€ ë¦¬ë§ˆì¸ë” ì‹œê°„
â”‚   â”œâ”€â”€ ì—…ì  ì•Œë¦¼ (on/off)
â”‚   â””â”€â”€ ë„ì „ ì•Œë¦¼ (on/off)
â”‚
â”œâ”€â”€ ê°œì¸ì •ë³´
â”‚   â”œâ”€â”€ ë‹‰ë„¤ì„ ìˆ˜ì •
â”‚   â”œâ”€â”€ ì²´ì¤‘ ìˆ˜ì •
â”‚   â””â”€â”€ ëª©í‘œ ìˆ˜ì •
â”‚
â”œâ”€â”€ ê³„ì •
â”‚   â”œâ”€â”€ ì—°ê²°ëœ ê³„ì • (Google/Apple/ì¹´ì¹´ì˜¤)
â”‚   â”œâ”€â”€ ë¡œê·¸ì•„ì›ƒ
â”‚   â””â”€â”€ íšŒì› íƒˆí‡´
â”‚
â””â”€â”€ ì•± ì •ë³´
    â”œâ”€â”€ ë²„ì „ ì •ë³´
    â”œâ”€â”€ ì´ìš©ì•½ê´€
    â”œâ”€â”€ ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨
    â””â”€â”€ ì˜¤í”ˆì†ŒìŠ¤ ë¼ì´ì„ ìŠ¤
```

### ì„¤ì •ë³„ ì €ì¥ ìœ„ì¹˜

| ì„¤ì • | ì €ì¥ ìœ„ì¹˜ | ì´ìœ  |
|------|----------|------|
| ëŸ¬ë‹ ì„¤ì • | ë¡œì»¬ + ì„œë²„ | ê¸°ê¸° ê°„ ë™ê¸°í™” |
| ë‹¨ìœ„ ì„¤ì • | ë¡œì»¬ + ì„œë²„ | ê¸°ê¸° ê°„ ë™ê¸°í™” |
| ì•Œë¦¼ ì„¤ì • | ë¡œì»¬ + ì„œë²„ | ê¸°ê¸° ê°„ ë™ê¸°í™” |
| ê°œì¸ì •ë³´ | ì„œë²„ | Authì™€ ì—°ë™ |

---

## 7. ì•„í‚¤í…ì²˜

### í´ë” êµ¬ì¡°

```
lib/features/profile/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ datasources/
â”‚   â”‚   â”œâ”€â”€ profile_remote_datasource.dart
â”‚   â”‚   â””â”€â”€ settings_local_datasource.dart
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ profile_stats_model.dart
â”‚   â”‚   â”œâ”€â”€ user_level_model.dart
â”‚   â”‚   â”œâ”€â”€ achievement_model.dart
â”‚   â”‚   â””â”€â”€ user_settings_model.dart
â”‚   â””â”€â”€ repositories/
â”‚       â”œâ”€â”€ profile_repository_impl.dart
â”‚       â”œâ”€â”€ achievement_repository_impl.dart
â”‚       â””â”€â”€ settings_repository_impl.dart
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”œâ”€â”€ profile_stats.dart
â”‚   â”‚   â”œâ”€â”€ user_level.dart
â”‚   â”‚   â”œâ”€â”€ achievement.dart
â”‚   â”‚   â””â”€â”€ user_settings.dart
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”œâ”€â”€ profile_repository.dart
â”‚   â”‚   â”œâ”€â”€ achievement_repository.dart
â”‚   â”‚   â””â”€â”€ settings_repository.dart
â”‚   â””â”€â”€ usecases/
â”‚       â”œâ”€â”€ get_profile_stats.dart
â”‚       â”œâ”€â”€ get_user_level.dart
â”‚       â”œâ”€â”€ get_achievements.dart
â”‚       â”œâ”€â”€ check_new_achievements.dart
â”‚       â”œâ”€â”€ get_settings.dart
â”‚       â””â”€â”€ update_settings.dart
â””â”€â”€ presentation/
    â”œâ”€â”€ providers/
    â”‚   â”œâ”€â”€ profile_providers.dart
    â”‚   â”œâ”€â”€ stats_provider.dart
    â”‚   â”œâ”€â”€ level_provider.dart
    â”‚   â”œâ”€â”€ achievements_provider.dart
    â”‚   â””â”€â”€ settings_provider.dart
    â”œâ”€â”€ screens/
    â”‚   â”œâ”€â”€ profile_screen.dart
    â”‚   â”œâ”€â”€ stats_detail_screen.dart
    â”‚   â”œâ”€â”€ achievements_screen.dart
    â”‚   â”œâ”€â”€ settings_screen.dart
    â”‚   â””â”€â”€ edit_profile_screen.dart
    â””â”€â”€ widgets/
        â”œâ”€â”€ profile_header.dart
        â”œâ”€â”€ stats_summary_card.dart
        â”œâ”€â”€ level_progress_bar.dart
        â”œâ”€â”€ achievement_badge.dart
        â”œâ”€â”€ achievement_showcase.dart
        â”œâ”€â”€ goal_progress_card.dart
        â””â”€â”€ settings_tile.dart
```

### Provider êµ¬ì¡°

```dart
// í”„ë¡œí•„ í†µê³„
@riverpod
Future<ProfileStats> profileStats(ProfileStatsRef ref) async {
  final repository = ref.watch(profileRepositoryProvider);
  final userId = ref.watch(currentUserIdProvider);
  return repository.getStats(userId);
}

// ìœ ì € ë ˆë²¨
@riverpod
Future<UserLevel> userLevel(UserLevelRef ref) async {
  final repository = ref.watch(profileRepositoryProvider);
  final userId = ref.watch(currentUserIdProvider);
  final totalXp = await repository.getTotalXp(userId);
  return LevelService.calculateLevel(totalXp);
}

// ì—…ì  ëª©ë¡
@riverpod
Future<List<Achievement>> achievements(AchievementsRef ref) async {
  final repository = ref.watch(achievementRepositoryProvider);
  final userId = ref.watch(currentUserIdProvider);
  return repository.getAchievements(userId);
}

// ì„¤ì •
@riverpod
class Settings extends _$Settings {
  @override
  Future<UserSettings> build() async {
    final repository = ref.watch(settingsRepositoryProvider);
    return repository.getSettings();
  }

  Future<void> update(UserSettings settings) async {
    final repository = ref.read(settingsRepositoryProvider);
    await repository.saveSettings(settings);
    ref.invalidateSelf();
  }
}
```

---

## 8. UI ì»´í¬ë„ŒíŠ¸

### ProfileHeader

```dart
class ProfileHeader extends StatelessWidget {
  final UserProfile profile;
  final UserLevel level;

  @override
  Widget build(BuildContext context) {
    return Row(
      children: [
        CircleAvatar(
          radius: 40,
          backgroundImage: profile.avatarUrl != null
            ? NetworkImage(profile.avatarUrl!)
            : null,
          child: profile.avatarUrl == null
            ? Text(profile.nickname[0])
            : null,
        ),
        const SizedBox(width: 16),
        Expanded(
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Text(profile.nickname, style: TextStyle(fontSize: 20, fontWeight: FontWeight.bold)),
              Text('Lv.${level.level} ${level.title}', style: TextStyle(color: Colors.grey)),
              const SizedBox(height: 8),
              LevelProgressBar(
                current: level.currentXp,
                max: level.xpForNextLevel,
              ),
            ],
          ),
        ),
      ],
    );
  }
}
```

### LevelProgressBar

```dart
class LevelProgressBar extends StatelessWidget {
  final int current;
  final int max;

  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        LinearProgressIndicator(
          value: current / max,
          backgroundColor: Colors.grey[300],
          valueColor: AlwaysStoppedAnimation(Theme.of(context).primaryColor),
        ),
        const SizedBox(height: 4),
        Text('$current / $max XP', style: TextStyle(fontSize: 12, color: Colors.grey)),
      ],
    );
  }
}
```

### AchievementBadge

```dart
class AchievementBadge extends StatelessWidget {
  final Achievement achievement;
  final bool showProgress;

  @override
  Widget build(BuildContext context) {
    final isLocked = !achievement.isUnlocked;

    return Column(
      children: [
        Container(
          width: 64,
          height: 64,
          decoration: BoxDecoration(
            shape: BoxShape.circle,
            color: isLocked ? Colors.grey[300] : Colors.amber[100],
            border: Border.all(
              color: isLocked ? Colors.grey : Colors.amber,
              width: 2,
            ),
          ),
          child: Center(
            child: Text(
              achievement.iconUrl,  // ì´ëª¨ì§€ ì‚¬ìš©
              style: TextStyle(
                fontSize: 32,
                color: isLocked ? Colors.grey : null,
              ),
            ),
          ),
        ),
        const SizedBox(height: 4),
        Text(
          achievement.name,
          style: TextStyle(
            fontSize: 12,
            color: isLocked ? Colors.grey : Colors.black,
          ),
          textAlign: TextAlign.center,
        ),
        if (showProgress && !achievement.isUnlocked && achievement.currentProgress != null)
          Text(
            '${achievement.currentProgress}/${achievement.targetProgress}',
            style: TextStyle(fontSize: 10, color: Colors.grey),
          ),
      ],
    );
  }
}
```

---

## 9. ì—°ì† ëŸ¬ë‹ (Streak) ê³„ì‚°

### ë¡œì§

```dart
class StreakService {
  Future<int> calculateCurrentStreak(String userId) async {
    // ì˜¤ëŠ˜ ê¸°ì¤€ìœ¼ë¡œ ì—°ì† ëŸ¬ë‹ ì¼ìˆ˜ ê³„ì‚°
    final runs = await getRunsByUser(userId, orderByDate: true);

    if (runs.isEmpty) return 0;

    int streak = 0;
    DateTime checkDate = DateTime.now();

    // ì˜¤ëŠ˜ ëŸ¬ë‹ì´ ì—†ìœ¼ë©´ ì–´ì œë¶€í„° ì‹œì‘
    final todayRuns = runs.where((r) => isSameDay(r.startedAt, checkDate));
    if (todayRuns.isEmpty) {
      checkDate = checkDate.subtract(Duration(days: 1));
    }

    for (final run in runs) {
      if (isSameDay(run.startedAt, checkDate)) {
        streak++;
        checkDate = checkDate.subtract(Duration(days: 1));
      } else if (run.startedAt.isBefore(checkDate)) {
        break;  // ì—°ì† ëŠê¹€
      }
    }

    return streak;
  }
}
```

### Supabase Function (ì„ íƒ)

```sql
create or replace function get_current_streak(p_user_id uuid)
returns int as $$
declare
  streak int := 0;
  check_date date := current_date;
  has_run boolean;
begin
  loop
    select exists(
      select 1 from run_sessions
      where user_id = p_user_id
        and date(started_at) = check_date
        and status = 'completed'
    ) into has_run;

    if has_run then
      streak := streak + 1;
      check_date := check_date - interval '1 day';
    else
      -- ì˜¤ëŠ˜ ëŸ¬ë‹ ì—†ìœ¼ë©´ ì–´ì œë¶€í„° ì²´í¬
      if check_date = current_date then
        check_date := check_date - interval '1 day';
      else
        exit;
      end if;
    end if;
  end loop;

  return streak;
end;
$$ language plpgsql;
```

---

## 10. í…ŒìŠ¤íŠ¸ ì „ëµ

### ìš°ì„ ìˆœìœ„

| ìš°ì„ ìˆœìœ„ | ì˜ì—­ | ì´ìœ  |
|----------|------|------|
| ğŸ”´ ë†’ìŒ | LevelService | XP/ë ˆë²¨ ê³„ì‚° í•µì‹¬ ë¡œì§ |
| ğŸ”´ ë†’ìŒ | AchievementService | ì—…ì  ì²´í¬ ì¡°ê±´ |
| ğŸ”´ ë†’ìŒ | StreakService | ì—°ì† ê¸°ë¡ ê³„ì‚° |
| ğŸŸ¡ ì¤‘ê°„ | ProfileRepository | í†µê³„ ì§‘ê³„ ì •í™•ì„± |
| ğŸŸ¡ ì¤‘ê°„ | SettingsRepository | ì„¤ì • ì €ì¥/ë¡œë“œ |
| ğŸŸ¢ ë‚®ìŒ | ProfileScreen | UI ë Œë”ë§ |

### ì£¼ìš” í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

**LevelService**
- XP 0 â†’ ë ˆë²¨ 1
- XP 100 â†’ ë ˆë²¨ 2
- XP ê²½ê³„ê°’ í…ŒìŠ¤íŠ¸ (99, 100, 101)
- ìµœëŒ€ ë ˆë²¨ ë„ë‹¬

**AchievementService**
- ì¡°ê±´ ë¯¸ì¶©ì¡± ì‹œ ë¯¸íšë“
- ì¡°ê±´ ì¶©ì¡± ì‹œ íšë“
- ì¤‘ë³µ íšë“ ë°©ì§€
- XP ì •ìƒ ë¶€ì—¬

**StreakService**
- ì—°ì† ëŸ¬ë‹ ì •ìƒ ê³„ì‚°
- í•˜ë£¨ ê±´ë„ˆëœ€ â†’ ì—°ì† ëŠê¹€
- ì˜¤ëŠ˜ ëŸ¬ë‹ ì—†ì„ ë•Œ ì–´ì œë¶€í„° ê³„ì‚°
- ë¹ˆ ê¸°ë¡ â†’ 0

---

## ê¸°ìˆ  ìŠ¤íƒ

| ì˜ì—­ | ê¸°ìˆ  |
|------|------|
| ìƒíƒœ ê´€ë¦¬ | Riverpod |
| ë°ì´í„°ë² ì´ìŠ¤ | Supabase PostgreSQL |
| ë¡œì»¬ ì €ì¥ | SharedPreferences (ì„¤ì •) |
| ì°¨íŠ¸ | fl_chart (í†µê³„ ì‹œê°í™”) |

---

## ë‹¤ìŒ ë‹¨ê³„

1. Course Recommendation êµ¬í˜„ ì™„ë£Œ í›„ ì§„í–‰
2. Auth êµ¬í˜„ í›„ Profile êµ¬í˜„ (ì˜ì¡´ì„±)
3. Tracking êµ¬í˜„ê³¼ í•¨ê»˜ ì—…ì  ì²´í¬ ì—°ë™
